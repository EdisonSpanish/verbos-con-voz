<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EsVoz ‚Äì Verbos en Espa√±ol</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700&display=swap');
  :root {
    --primary: #6C3FC5; --primary-light: #9B6EF3;
    --secondary: #F2A541; --accent: #E8445A; --success: #2DCB73;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #1a0533 0%, #2d1066 40%, #1a1a4e 100%);
    min-height: 100vh; color: #fff; overflow-x: hidden;
  }
  body::before {
    content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background-image:
      radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.5) 0%, transparent 100%),
      radial-gradient(1px 1px at 30% 70%, rgba(255,255,255,.3) 0%, transparent 100%),
      radial-gradient(1px 1px at 50% 15%, rgba(255,255,255,.6) 0%, transparent 100%),
      radial-gradient(1px 1px at 70% 50%, rgba(255,255,255,.4) 0%, transparent 100%),
      radial-gradient(1px 1px at 85% 30%, rgba(255,255,255,.5) 0%, transparent 100%),
      radial-gradient(1px 1px at 20% 85%, rgba(255,255,255,.3) 0%, transparent 100%),
      radial-gradient(1px 1px at 60% 90%, rgba(255,255,255,.4) 0%, transparent 100%),
      radial-gradient(1px 1px at 75% 10%, rgba(255,255,255,.5) 0%, transparent 100%);
  }
  .screen { display: none; position: relative; z-index: 1; }
  .screen.active { display: block; }
  header { text-align: center; padding: 36px 20px 24px; }
  .logo {
    display: inline-flex; align-items: center; gap: 12px;
    background: rgba(255,255,255,0.08); backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.15); border-radius: 50px;
    padding: 10px 28px; margin-bottom: 18px;
  }
  .logo-text { font-family: 'Playfair Display', serif; font-size: 1.45rem; color: #fff; letter-spacing: 2px; }
  header h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.9rem, 5vw, 3rem); color: #fff;
    text-shadow: 0 2px 20px rgba(155,110,243,0.6);
  }
  header p { color: rgba(255,255,255,0.65); font-size: 1rem; margin-top: 8px; }
  .verb-list-container { max-width: 1100px; margin: 0 auto; padding: 16px 20px 60px; }
  .filter-bar { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 24px; }
  .filter-btn {
    padding: 8px 20px; border-radius: 50px;
    border: 2px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.07);
    color: rgba(255,255,255,0.75); font-family: 'Poppins', sans-serif;
    font-size: .88rem; font-weight: 500; cursor: pointer; transition: all .2s;
  }
  .filter-btn.active, .filter-btn:hover { background: var(--primary-light); border-color: var(--primary-light); color: #fff; }
  .search-input {
    padding: 10px 20px; border-radius: 50px;
    border: 2px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.07);
    color: #fff; font-family: 'Poppins', sans-serif; font-size: .9rem; width: 220px;
    transition: all .2s; outline: none;
  }
  .search-input::placeholder { color: rgba(255,255,255,0.35); }
  .search-input:focus { border-color: var(--primary-light); background: rgba(255,255,255,0.11); }
  .verb-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(155px, 1fr)); gap: 12px; }
  .verb-card {
    background: rgba(255,255,255,0.07); border: 1.5px solid rgba(255,255,255,0.1);
    border-radius: 18px; padding: 18px 14px; text-align: center; cursor: pointer;
    transition: all .25s; backdrop-filter: blur(6px); position: relative;
  }
  .verb-card:hover {
    transform: translateY(-5px); border-color: var(--primary-light);
    background: rgba(108,63,197,0.25); box-shadow: 0 12px 30px rgba(108,63,197,0.25);
  }
  .verb-card.selected { border: 2px solid var(--secondary); background: rgba(242,165,65,0.15); }
  .verb-card.selected::after { content: "‚úì"; position: absolute; top: 5px; right: 10px; color: var(--secondary); font-weight: bold; }
  .v-inf { font-size: 1.12rem; font-weight: 700; color: #fff; display: block; }
  .v-meaning { font-size: .72rem; color: rgba(255,255,255,0.5); margin-top: 5px; display: block; }
  .v-badge { display: inline-block; margin-top: 9px; font-size: .62rem; padding: 3px 11px; border-radius: 50px; font-weight: 600; text-transform: uppercase; letter-spacing: .5px; }
  .regular  { background: rgba(45,203,115,0.18); color: #2DCB73; border: 1px solid rgba(45,203,115,0.28); }
  .irregular{ background: rgba(242,165,65,0.18); color: #F2A541; border: 1px solid rgba(242,165,65,0.28); }
  .reflexive{ background: rgba(232,68,90,0.18); color: #E8445A; border: 1px solid rgba(232,68,90,0.28); }
  .game-container { max-width: 760px; margin: 0 auto; padding: 16px 20px 60px; }
  .game-top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
  .back-btn {
    display: flex; align-items: center; gap: 8px;
    background: rgba(255,255,255,0.09); border: 1.5px solid rgba(255,255,255,0.18);
    color: #fff; padding: 9px 20px; border-radius: 50px; cursor: pointer;
    font-family: 'Poppins', sans-serif; font-size: .88rem; transition: all .2s;
  }
  .back-btn:hover { background: rgba(255,255,255,0.16); }
  .progress-wrap { display: flex; align-items: center; gap: 12px; color: rgba(255,255,255,0.75); font-size: .88rem; }
  .progress-dots { display: flex; gap: 6px; }
  .pdot { width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,0.18); transition: all .3s; }
  .pdot.done { background: var(--success); }
  .pdot.current { background: var(--secondary); transform: scale(1.35); }
  .verb-hero {
    background: linear-gradient(135deg, rgba(108,63,197,0.55), rgba(45,10,90,0.75));
    border: 1.5px solid rgba(155,110,243,0.35); border-radius: 28px; padding: 34px;
    text-align: center; margin-bottom: 28px; backdrop-filter: blur(12px);
    box-shadow: 0 16px 50px rgba(108,63,197,0.3); position: relative; overflow: hidden;
  }
  .verb-hero::after {
    content: ''; position: absolute; top: -40px; right: -40px;
    width: 150px; height: 150px; border-radius: 50%;
    background: radial-gradient(circle, rgba(155,110,243,0.2), transparent 70%);
  }
  .v-label { font-size: .75rem; text-transform: uppercase; letter-spacing: 3px; color: rgba(255,255,255,0.5); margin-bottom: 8px; }
  .v-infinitive {
    font-family: 'Playfair Display', serif; font-size: clamp(2.2rem, 7vw, 3.6rem);
    color: #fff; text-shadow: 0 0 40px rgba(155,110,243,0.7); line-height: 1;
  }
  .v-meaning-disp { margin-top: 12px; color: rgba(255,255,255,0.55); font-size: .92rem; }
  .conjugation-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 28px; }
  .conj-row {
    background: rgba(255,255,255,0.06); border: 2px solid rgba(255,255,255,0.09);
    border-radius: 16px; padding: 16px 20px; display: flex; flex-direction: column; gap: 4px; transition: all .3s;
  }
  .conj-row.current { border-color: var(--secondary); background: rgba(242,165,65,0.09); box-shadow: 0 0 22px rgba(242,165,65,0.18); }
  .conj-row.done { border-color: var(--success); background: rgba(45,203,115,0.07); }
  .conj-row.wrong { border-color: var(--accent); background: rgba(232,68,90,0.1); animation: shake .4s ease; }
  @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-7px)} 40%,80%{transform:translateX(7px)} }
  .pronoun-label { font-size: .72rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5px; color: rgba(255,255,255,0.4); }
  .conj-row.current .pronoun-label { color: var(--secondary); }
  .conj-row.done .pronoun-label { color: var(--success); }
  .conjugated-form { font-size: 1.35rem; font-weight: 700; color: #fff; min-height: 1.9rem; transition: all .4s; }
  @keyframes revealWord {
    0%{opacity:0;transform:scale(.5) translateY(10px);filter:blur(8px)}
    60%{transform:scale(1.1) translateY(-2px)}
    100%{opacity:1;transform:scale(1) translateY(0);filter:blur(0)}
  }
  .conj-row.done .conjugated-form { animation: revealWord .55s cubic-bezier(.34,1.56,.64,1); }
  .mic-section { text-align: center; margin-bottom: 22px; }
  .mic-btn {
    width: 86px; height: 86px; border-radius: 50%; border: none;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    box-shadow: 0 8px 28px rgba(108,63,197,0.5); cursor: pointer; font-size: 1.9rem;
    display: inline-flex; align-items: center; justify-content: center; transition: all .2s;
  }
  .mic-btn:hover { transform: scale(1.06); box-shadow: 0 12px 38px rgba(108,63,197,0.6); }
  .mic-btn.listening { background: linear-gradient(135deg, var(--accent), #ff6b80); animation: pulse 1.2s infinite; }
  @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(232,68,90,.6)} 70%{box-shadow:0 0 0 24px rgba(232,68,90,0)} 100%{box-shadow:0 0 0 0 rgba(232,68,90,0)} }
  .mic-status { margin-top: 12px; color: rgba(255,255,255,0.55); font-size: .88rem; min-height: 22px; }
  .mic-status strong { color: var(--secondary); }
  .heard-text {
    background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px; padding: 12px 20px; text-align: center;
    color: rgba(255,255,255,0.65); font-size: .88rem; min-height: 46px;
    margin-bottom: 12px; transition: all .2s; line-height: 1.5;
  }
  .hint-box {
    background: rgba(242,165,65,0.09); border: 1px solid rgba(242,165,65,0.22);
    border-radius: 12px; padding: 10px 18px; color: var(--secondary);
    font-size: .85rem; margin-bottom: 12px; text-align: center; display: none;
  }
  .btn-row { text-align: center; margin-bottom: 22px; }
  .hint-btn {
    background: rgba(242,165,65,0.13); border: 1px solid rgba(242,165,65,0.28);
    color: var(--secondary); padding: 9px 22px; border-radius: 50px; cursor: pointer;
    font-family: 'Poppins', sans-serif; font-size: .85rem; font-weight: 500; margin: 4px; transition: all .2s;
  }
  .hint-btn:hover { background: rgba(242,165,65,0.22); }
  .skip-btn {
    background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.13);
    color: rgba(255,255,255,0.55); padding: 9px 22px; border-radius: 50px; cursor: pointer;
    font-family: 'Poppins', sans-serif; font-size: .85rem; font-weight: 500; margin: 4px; transition: all .2s;
  }
  .skip-btn:hover { background: rgba(255,255,255,0.13); color: #fff; }
  .no-support {
    background: rgba(232,68,90,0.13); border: 1px solid rgba(232,68,90,0.28);
    border-radius: 12px; padding: 13px 18px; color: #E8445A;
    font-size: .85rem; text-align: center; margin-bottom: 18px; display: none;
  }
  .completion-card {
    background: linear-gradient(135deg, rgba(45,203,115,0.18), rgba(108,63,197,0.28));
    border: 2px solid rgba(45,203,115,0.35); border-radius: 24px; padding: 40px;
    text-align: center; display: none;
  }
  .completion-card.show { display: block; animation: bounceIn .6s cubic-bezier(.34,1.56,.64,1); }
  @keyframes bounceIn { 0%{transform:scale(.4);opacity:0} 100%{transform:scale(1);opacity:1} }
  .completion-card .big-emoji { font-size: 4rem; display: block; margin-bottom: 14px; }
  .completion-card h2 { font-size: 1.75rem; color: #fff; margin-bottom: 8px; }
  .completion-card p { color: rgba(255,255,255,0.65); margin-bottom: 22px; font-size: .95rem; }
  .next-btn {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border: none; color: #fff; padding: 13px 32px; border-radius: 50px;
    font-family: 'Poppins', sans-serif; font-size: .95rem; font-weight: 600;
    cursor: pointer; box-shadow: 0 8px 24px rgba(108,63,197,0.4); transition: all .2s; margin: 6px;
  }
  .next-btn:hover { transform: translateY(-2px); }
  .next-btn.green { background: linear-gradient(135deg, #2DCB73, #1da55e); }
  .multi-start-btn {
    position: fixed; bottom: 20px; right: 20px; z-index: 100;
    background: var(--secondary); color: #000; padding: 15px 30px; border-radius: 50px;
    font-weight: bold; border: none; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    display: none;
  }
  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-thumb { background: rgba(155,110,243,0.35); border-radius: 3px; }
  @media(max-width:520px) {
    .conjugation-grid { grid-template-columns: 1fr; }
    .verb-grid { grid-template-columns: repeat(auto-fill, minmax(130px,1fr)); }
  }
</style>
</head>
<body>

<button class="multi-start-btn" id="multiStartBtn" onclick="startQueue()">Practicar Selecci√≥n (0)</button>

<div class="screen active" id="screen-list">
  <header>
    <div class="logo"><span>üá™üá∏</span><span class="logo-text">EsVoz</span></div>
    <h1>Elige tu verbo</h1>
    <p>Selecciona uno o varios verbos y practica su conjugaci√≥n con tu voz</p>
  </header>
  <div class="verb-list-container">
    <div class="filter-bar">
      <button class="filter-btn active" onclick="filterVerbs('all',this)">Todos</button>
      <button class="filter-btn" onclick="filterVerbs('regular',this)">Regulares</button>
      <button class="filter-btn" onclick="filterVerbs('irregular',this)">Irregulares</button>
      <button class="filter-btn" onclick="filterVerbs('reflexive',this)">Reflexivos</button>
      <input class="search-input" type="text" placeholder="üîç  Buscar verbo..." id="searchInput" oninput="searchVerbs(this.value)">
    </div>
    <div class="verb-grid" id="verbGrid"></div>
  </div>
</div>

<div class="screen" id="screen-game">
  <div class="game-container">
    <div class="game-top-bar">
      <button class="back-btn" onclick="goBack()">‚Üê Lista de verbos</button>
      <div class="progress-wrap">
        <span id="progressText">0 / 6</span>
        <div class="progress-dots" id="progressDots"></div>
      </div>
    </div>
    <div class="no-support" id="noSupportMsg">‚ö†Ô∏è Tu navegador no admite reconocimiento de voz. Usa <strong>Google Chrome</strong>.</div>
    <div class="verb-hero">
      <div class="v-label">Conjuga en presente de indicativo</div>
      <div class="v-infinitive" id="verbDisplay">‚Äî</div>
      <div class="v-meaning-disp" id="verbMeaning"></div>
    </div>
    <div class="conjugation-grid" id="conjGrid"></div>
    <div class="heard-text" id="heardText">Pulsa el micr√≥fono y di la forma correcta...</div>
    <div class="hint-box" id="hintBox"></div>
    <div class="mic-section">
      <button class="mic-btn" id="micBtn" onclick="toggleMic()">üé§</button>
      <div class="mic-status" id="micStatus">Listo para escuchar</div>
    </div>
    <div class="btn-row">
      <button class="hint-btn" onclick="showHint()">üí° Pista</button>
      <button class="skip-btn" onclick="skipCurrent()">Saltar ‚Üí</button>
    </div>
    <div class="completion-card" id="completionCard">
      <span class="big-emoji">üéâ</span>
      <h2 id="compTitle">¬°Excelente trabajo!</h2>
      <p>Has conjugado <strong id="completedVerbName"></strong> correctamente.</p>
      <button class="next-btn" id="queueBtn" style="display:none;" onclick="nextInQueue()">Siguiente Verbo</button>
      <button class="next-btn" onclick="goBack()">Elegir otros</button>
      <button class="next-btn green" onclick="pickRandomVerb()">Verbo aleatorio üé≤</button>
    </div>
  </div>
</div>

<script>
const VERBS = [
  {inf:"hablar",   meaning:"to speak",            type:"regular",   conj:["hablo","hablas","habla","hablamos","hablan","hablan"]},
  {inf:"trabajar", meaning:"to work",             type:"regular",   conj:["trabajo","trabajas","trabaja","trabajamos","trabajan","trabajan"]},
  {inf:"caminar",  meaning:"to walk",             type:"regular",   conj:["camino","caminas","camina","caminamos","caminan","caminan"]},
  {inf:"escuchar", meaning:"to listen",           type:"regular",   conj:["escucho","escuchas","escucha","escuchamos","escuchan","escuchan"]},
  {inf:"comprar",  meaning:"to buy",              type:"regular",   conj:["compro","compras","compra","compramos","compran","compran"]},
  {inf:"mirar",    meaning:"to look at",          type:"regular",   conj:["miro","miras","mira","miramos","miran","miran"]},
  {inf:"tomar",    meaning:"to take / drink",     type:"regular",   conj:["tomo","tomas","toma","tomamos","toman","toman"]},
  {inf:"usar",     meaning:"to use",              type:"regular",   conj:["uso","usas","usa","usamos","usan","usan"]},
  {inf:"necesitar",meaning:"to need",             type:"regular",   conj:["necesito","necesitas","necesita","necesitamos","necesitan","necesitan"]},
  {inf:"llamar",   meaning:"to call",             type:"regular",   conj:["llamo","llamas","llama","llamamos","llaman","llaman"]},
  {inf:"llevar",   meaning:"to carry / wear",     type:"regular",   conj:["llevo","llevas","lleva","llevamos","llevan","llevan"]},
  {inf:"dejar",    meaning:"to leave / let",      type:"regular",   conj:["dejo","dejas","deja","dejamos","dejan","dejan"]},
  {inf:"pasar",    meaning:"to pass / happen",    type:"regular",   conj:["paso","pasas","pasa","pasamos","pasan","pasan"]},
  {inf:"buscar",   meaning:"to look for",         type:"regular",   conj:["busco","buscas","busca","buscamos","buscan","buscan"]},
  {inf:"ayudar",   meaning:"to help",             type:"regular",   conj:["ayudo","ayudas","ayuda","ayudamos","ayudan","ayudan"]},
  {inf:"comer",    meaning:"to eat",              type:"regular",   conj:["como","comes","come","comemos","comen","comen"]},
  {inf:"beber",    meaning:"to drink",            type:"regular",   conj:["bebo","bebes","bebe","bebemos","beben","beben"]},
  {inf:"aprender", meaning:"to learn",            type:"regular",   conj:["aprendo","aprendes","aprende","aprendemos","aprenden","aprenden"]},
  {inf:"correr",   meaning:"to run",              type:"regular",   conj:["corro","corres","corre","corremos","corren","corren"]},
  {inf:"leer",     meaning:"to read",             type:"regular",   conj:["leo","lees","lee","leemos","leen","leen"]},
  {inf:"comprender",meaning:"to understand",       type:"regular",   conj:["comprendo","comprendes","comprende","comprendemos","comprenden","comprenden"]},
  {inf:"vivir",    meaning:"to live",             type:"regular",   conj:["vivo","vives","vive","vivimos","viven","viven"]},
  {inf:"escribir", meaning:"to write",            type:"regular",   conj:["escribo","escribes","escribe","escribimos","escriben","escriben"]},
  {inf:"abrir",    meaning:"to open",             type:"regular",   conj:["abro","abres","abre","abrimos","abren","abren"]},
  {inf:"subir",    meaning:"to go up",            type:"regular",   conj:["subo","subes","sube","subimos","suben","suben"]},
  {inf:"recibir",  meaning:"to receive",          type:"regular",   conj:["recibo","recibes","recibe","recibimos","reciben","reciben"]},
  {inf:"decidir",  meaning:"to decide",           type:"regular",   conj:["decido","decides","decide","decidimos","deciden","deciden"]},
  {inf:"ser",      meaning:"to be (permanent)",   type:"irregular", conj:["soy","eres","es","somos","son","son"]},
  {inf:"estar",    meaning:"to be (temporary)",   type:"irregular", conj:["estoy","est√°s","est√°","estamos","est√°n","est√°n"]},
  {inf:"tener",    meaning:"to have",             type:"irregular", conj:["tengo","tienes","tiene","tenemos","tienen","tienen"]},
  {inf:"hacer",    meaning:"to do / make",        type:"irregular", conj:["hago","haces","hace","hacemos","hacen","hacen"]},
  {inf:"ir",       meaning:"to go",               type:"irregular", conj:["voy","vas","va","vamos","van","van"]},
  {inf:"venir",    meaning:"to come",             type:"irregular", conj:["vengo","vienes","viene","venimos","vienen","vienen"]},
  {inf:"decir",    meaning:"to say / tell",       type:"irregular", conj:["digo","dices","dice","decimos","dicen","dicen"]},
  {inf:"poder",    meaning:"to be able to",       type:"irregular", conj:["puedo","puedes","puede","podemos","pueden","pueden"]},
  {inf:"querer",   meaning:"to want / love",      type:"irregular", conj:["quiero","quieres","quiere","queremos","quieren","quieren"]},
  {inf:"saber",    meaning:"to know",             type:"irregular", conj:["s√©","sabes","sabe","sabemos","saben","saben"]},
  {inf:"poner",    meaning:"to put / place",      type:"irregular", conj:["pongo","pones","pone","ponemos","ponen","ponen"]},
  {inf:"salir",    meaning:"to go out",           type:"irregular", conj:["salgo","sales","sale","salimos","salen","salen"]},
  {inf:"ver",      meaning:"to see",              type:"irregular", conj:["veo","ves","ve","vemos","ven","ven"]},
  {inf:"dar",      meaning:"to give",             type:"irregular", conj:["doy","das","da","damos","dan","dan"]},
  {inf:"conocer",  meaning:"to know (people)",    type:"irregular", conj:["conozco","conoces","conoce","conocemos","conocen","conocen"]},
  {inf:"traer",    meaning:"to bring",            type:"irregular", conj:["traigo","traes","trae","traemos","traen","traen"]},
  {inf:"o√≠r",      meaning:"to hear",             type:"irregular", conj:["oigo","oyes","oye","o√≠mos","oyen","oyen"]},
  {inf:"caer",     meaning:"to fall",             type:"irregular", conj:["caigo","caes","cae","caemos","caen","caen"]},
  {inf:"conducir", meaning:"to drive",            type:"irregular", conj:["conduzco","conduces","conduce","conducimos","conducen","conducen"]},
  {inf:"traducir", meaning:"to translate",        type:"irregular", conj:["traduzco","traduces","traduce","traducimos","traducen","traducen"]},
  {inf:"seguir",   meaning:"to follow / continue",type:"irregular", conj:["sigo","sigues","sigue","seguimos","siguen","siguen"]},
  {inf:"conseguis",meaning:"to get / obtain",     type:"irregular", conj:["consigo","consigues","consigue","conseguimos","consiguen","consiguen"]},
  {inf:"elegir",   meaning:"to choose",           type:"irregular", conj:["elijo","eliges","elige","elegimos","eligen","eligen"]},
  {inf:"pedir",    meaning:"to ask for",          type:"irregular", conj:["pido","pides","pide","pedimos","piden","piden"]},
  {inf:"dormir",   meaning:"to sleep",            type:"irregular", conj:["duermo","duermes","duerme","dormimos","duermen","duermen"]},
  {inf:"morir",    meaning:"to die",              type:"irregular", conj:["muero","mueres","muere","morimos","mueren","mueren"]},
  {inf:"jugar",    meaning:"to play",             type:"irregular", conj:["juego","juegas","juega","jugamos","juegan","juegan"]},
  {inf:"contar",   meaning:"to count / tell",     type:"irregular", conj:["cuento","cuentas","cuenta","contamos","cuentan","cuentan"]},
  {inf:"volver",   meaning:"to return",           type:"irregular", conj:["vuelvo","vuelves","vuelve","volvemos","vuelven","vuelven"]},
  {inf:"entender", meaning:"to understand",       type:"irregular", conj:["entiendo","entiendes","entiende","entendemos","entienden","entienden"]},
  {inf:"perder",   meaning:"to lose",             type:"irregular", conj:["pierdo","pierdes","pierde","perdemos","pierden","pierden"]},
  {inf:"pensar",   meaning:"to think",            type:"irregular", conj:["pienso","piensas","piensa","pensamos","piensan","piensan"]},
  {inf:"empezar",  meaning:"to begin",            type:"irregular", conj:["empiezo","empiezas","empieza","empezamos","empiezan","empiezan"]},
  {inf:"cerrar",   meaning:"to close",            type:"irregular", conj:["cierro","cierras","cierra","cerramos","cierran","cierran"]},
  {inf:"sentir",   meaning:"to feel",             type:"irregular", conj:["siento","sientes","siente","sentimos","sienten","sienten"]},
  {inf:"repetir",  meaning:"to repeat",           type:"irregular", conj:["repito","repites","repite","repetimos","repiten","repiten"]},
  {inf:"mentir",   meaning:"to lie",              type:"irregular", conj:["miento","mientes","miente","mentimos","mienten","mienten"]},
  {inf:"preferir", meaning:"to prefer",           type:"irregular", conj:["prefiero","prefieres","prefiere","preferimos","prefieren","prefieren"]},
  {inf:"haber",    meaning:"to have (auxiliary)", type:"irregular", conj:["he","has","ha","hemos","han","han"]},
  {inf:"llamarse", meaning:"to be called",        type:"reflexive", conj:["me llamo","te llamas","se llama","nos llamamos","se llaman","se llaman"]},
  {inf:"levantarse",meaning:"to get up",          type:"reflexive", conj:["me levanto","te levantas","se levanta","nos levantamos","se levantan","se levantan"]},
  {inf:"acostarse",meaning:"to go to bed",        type:"reflexive", conj:["me acuesto","te acuestas","se acuesta","nos acostamos","se acuestan","se acuestan"]},
  {inf:"despertarse",meaning:"to wake up",        type:"reflexive", conj:["me despierto","te despiertas","se despierta","nos despertamos","se despiertan","se despiertan"]},
  {inf:"sentarse", meaning:"to sit down",         type:"reflexive", conj:["me siento","te sientas","se sienta","nos sentamos","se sientan","se sientan"]},
  {inf:"ponerse",  meaning:"to put on (clothes)", type:"reflexive", conj:["me pongo","te pones","se pone","nos ponemos","se ponen","se ponen"]},
];

const PRONOUNS = ["yo","t√∫","√©l / ella / Ud.","nosotros / as","Uds.","ellos / ellas"];

let currentVerb=null, currentIndex=0, recognition=null, isListening=false, activeType='all', searchQ='';
let selectedVerbs = [];
let queueIndex = 0;

function getFiltered(){
  return VERBS.filter(v=>{
    const mt=activeType==='all'||v.type===activeType;
    const ms=v.inf.toLowerCase().includes(searchQ)||v.meaning.toLowerCase().includes(searchQ);
    return mt&&ms;
  });
}

function renderVerbGrid(){
  const grid=document.getElementById('verbGrid');
  const verbs=getFiltered();
  grid.innerHTML='';
  if(!verbs.length){grid.innerHTML='<p style="color:rgba(255,255,255,0.4);padding:20px;">No se encontraron verbos.</p>';return;}
  verbs.forEach(v=>{
    const c=document.createElement('div');
    c.className='verb-card' + (selectedVerbs.includes(v) ? ' selected' : '');
    const tl=v.type==='regular'?'regular':v.type==='irregular'?'irregular':'reflexivo';
    c.innerHTML=`<span class="v-inf">${v.inf}</span><span class="v-meaning">${v.meaning}</span><span class="v-badge ${v.type}">${tl}</span>`;
    c.onclick=(e)=>{
        if(selectedVerbs.includes(v)){
            selectedVerbs = selectedVerbs.filter(item => item !== v);
        } else {
            selectedVerbs.push(v);
        }
        updateMultiBtn();
        renderVerbGrid();
    };
    grid.appendChild(c);
  });
}

function updateMultiBtn(){
    const btn = document.getElementById('multiStartBtn');
    if(selectedVerbs.length > 0){
        btn.style.display = 'block';
        btn.textContent = `Practicar Selecci√≥n (${selectedVerbs.length})`;
    } else {
        btn.style.display = 'none';
    }
}

function startQueue(){
    queueIndex = 0;
    startGame(selectedVerbs[queueIndex]);
}

function nextInQueue(){
    queueIndex++;
    if(queueIndex < selectedVerbs.length){
        startGame(selectedVerbs[queueIndex]);
    } else {
        goBack();
    }
}

function filterVerbs(type,btn){
  activeType=type;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderVerbGrid();
}
function searchVerbs(q){searchQ=q.toLowerCase().trim();renderVerbGrid();}

function startGame(verb){
  currentVerb=verb; currentIndex=0;
  document.getElementById('screen-list').classList.remove('active');
  document.getElementById('screen-game').classList.add('active');
  document.getElementById('verbDisplay').textContent=verb.inf;
  document.getElementById('verbMeaning').textContent=verb.meaning;
  document.getElementById('completionCard').classList.remove('show');
  document.getElementById('hintBox').style.display='none';
  document.getElementById('heardText').textContent='Pulsa el micr√≥fono y di la forma correcta...';
  renderConjGrid(); updateProgress(); setupSpeech();
  
  // Auto-activar micro
  setTimeout(() => { if(!isListening) toggleMic(); }, 600);
}

function renderConjGrid(){
  const grid=document.getElementById('conjGrid');
  grid.innerHTML='';
  PRONOUNS.forEach((p,i)=>{
    const r=document.createElement('div');
    r.className='conj-row'+(i===0?' current':'');
    r.id=`row-${i}`;
    r.innerHTML=`<span class="pronoun-label">${p}</span><span class="conjugated-form" id="form-${i}"></span>`;
    grid.appendChild(r);
  });
}
function updateProgress(){
  document.getElementById('progressText').textContent=`${currentIndex} / 6`;
  const dots=document.getElementById('progressDots');
  dots.innerHTML='';
  for(let i=0;i<6;i++){
    const d=document.createElement('div');
    d.className='pdot'+(i<currentIndex?' done':i===currentIndex?' current':'');
    dots.appendChild(d);
  }
}
function markCorrect(index){
  const row=document.getElementById(`row-${index}`);
  const form=document.getElementById(`form-${index}`);
  row.classList.remove('current','wrong');
  row.classList.add('done');
  form.textContent=currentVerb.conj[index];
  document.getElementById('hintBox').style.display='none';
  currentIndex++; updateProgress();
  if(currentIndex>=6){finishVerb();return;}
  document.getElementById(`row-${currentIndex}`).classList.add('current');
  document.getElementById('heardText').innerHTML=`‚úÖ ¬°Correcto! Ahora di la forma de <strong>"${PRONOUNS[currentIndex]}"</strong>`;
}
function markWrong(heard){
  const row=document.getElementById(`row-${currentIndex}`);
  row.classList.add('wrong');
  setTimeout(()=>row.classList.remove('wrong'),500);
  document.getElementById('heardText').innerHTML=`‚ùå Escuch√©: <strong>"${heard}"</strong> ‚Äî Int√©ntalo de nuevo`;
}
function finishVerb(){
  stopMic();
  document.getElementById('completedVerbName').textContent=currentVerb.inf;
  document.getElementById('completionCard').classList.add('show');
  
  const qBtn = document.getElementById('queueBtn');
  if(queueIndex < selectedVerbs.length - 1){
      qBtn.style.display = 'inline-block';
      qBtn.textContent = `Siguiente: ${selectedVerbs[queueIndex+1].inf}`;
  } else {
      qBtn.style.display = 'none';
  }
}
function goBack(){
    stopMic();
    selectedVerbs = [];
    updateMultiBtn();
    document.getElementById('screen-game').classList.remove('active');
    document.getElementById('screen-list').classList.add('active');
    renderVerbGrid();
}
function pickRandomVerb(){
    selectedVerbs = [];
    startGame(VERBS[Math.floor(Math.random()*VERBS.length)]);
}
function showHint(){
  if(!currentVerb||currentIndex>=6)return;
  const f=currentVerb.conj[currentIndex];
  const h=f.slice(0,Math.max(2,Math.ceil(f.length/2)));
  const box=document.getElementById('hintBox');
  box.style.display='block';
  box.textContent=`üí° Pista: empieza por "${h}..."`;
}
function skipCurrent(){
  if(!currentVerb||currentIndex>=6)return;
  const row=document.getElementById(`row-${currentIndex}`);
  const form=document.getElementById(`form-${currentIndex}`);
  row.classList.remove('current','wrong'); row.classList.add('done');
  form.textContent=currentVerb.conj[currentIndex]; form.style.color='#E8445A';
  currentIndex++; updateProgress();
  if(currentIndex>=6){finishVerb();return;}
  document.getElementById(`row-${currentIndex}`).classList.add('current');
  document.getElementById('heardText').innerHTML=`Di la forma de <strong>"${PRONOUNS[currentIndex]}"</strong>`;
}

function norm(s){return s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().replace(/[¬ø?!¬°,\.]/g,'').trim();}
function buildForms(raw){
  const forms=[raw];
  const stripped=raw.replace(/^(me |te |se |nos |os )/i,'').trim();
  if(stripped!==raw)forms.push(stripped);
  return forms.map(norm);
}

function setupSpeech(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){document.getElementById('noSupportMsg').style.display='block';return;}
  if(recognition){try{recognition.abort();}catch(e){}}
  recognition=new SR();
  recognition.lang='es-ES'; 
  recognition.continuous=true; 
  recognition.interimResults=false; 
  recognition.maxAlternatives=5;
  
  recognition.onresult=e=>{
    const result = e.results[e.results.length - 1];
    const expected=buildForms(currentVerb.conj[currentIndex]);
    let ok=false;
    for(let r=0;r<result.length;r++){
      const alt=norm(result[r].transcript);
      for(const exp of expected){if(alt===exp||alt.includes(exp)||exp.includes(alt)){ok=true;break;}}
      if(ok)break;
    }
    if(ok)markCorrect(currentIndex);
    else markWrong(result[0].transcript.trim());
  };
  recognition.onend=()=>{ if(isListening && currentIndex < 6) recognition.start(); };
}

function toggleMic(){
  if(currentIndex>=6)return;
  if(isListening){stopMic();return;}
  if(!recognition)setupSpeech();
  try{
    recognition.start(); isListening=true; updateMicUI();
  }catch(e){isListening=false;updateMicUI();}
}
function stopMic(){if(recognition){try{recognition.stop();}catch(e){}}isListening=false;updateMicUI();}
function updateMicUI(){
  const btn=document.getElementById('micBtn');
  const st=document.getElementById('micStatus');
  if(isListening){btn.classList.add('listening');btn.textContent='‚èπ';st.innerHTML='<strong>Micr√≥fono abierto</strong>';}
  else{btn.classList.remove('listening');btn.textContent='üé§';st.textContent='Pulsa para activar';}
}

renderVerbGrid();
</script>
</body>
</html>